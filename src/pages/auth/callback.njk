---
layout: layouts/base.njk  # Herda o template base
permalink: auth/callback/
---

<script>
  if (window.location.pathname.includes('/auth/callback')) {
  const codeVerifier = localStorage.getItem('oauth_code_verifier');
  if (codeVerifier) {
    const url = new URL(window.location.href);
    url.searchParams.set('code_verifier', codeVerifier);
    window.location.href = url.toString();
  }
}

(async function () {
  const supabase = window.supabaseClient.init();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) {
    window.location.href = '/auth/login';
    return;
  }

  // Recupera o ?redirect=... da URL
  const params = new URLSearchParams(window.location.search);
  const redirect = params.get('redirect') || '/dashboard';

  // Redireciona para onde ele estava
  window.location.href = redirect;
})();
</script>